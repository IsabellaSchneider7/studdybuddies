(this["webpackJsonpreact-express-starter"]=this["webpackJsonpreact-express-starter"]||[]).push([[0],{185:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n(2),r=n(73),i=n.n(r),o=(n(81),n(82),n(27)),s=n.n(o),d=n(74),l=n(7),j=n(75),b=n.n(j);var u=({username:e,handleUsernameChange:t,roomName:n,handleRoomNameChange:c,handleSubmit:r,connecting:i})=>Object(a.jsxs)("form",{onSubmit:r,children:[Object(a.jsx)("h2",{children:"Enter a room"}),Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"name",children:"Name:"}),Object(a.jsx)("input",{type:"text",id:"field",value:e,onChange:t,readOnly:i,required:!0})]}),Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"room",children:"Room name:"}),Object(a.jsx)("input",{type:"text",id:"room",value:n,onChange:c,readOnly:i,required:!0})]}),Object(a.jsx)("button",{type:"submit",disabled:i,children:i?"Connecting":"Join"})]});var h=({participant:e})=>{const t=Object(c.useState)([]),n=Object(l.a)(t,2),r=n[0],i=n[1],o=Object(c.useState)([]),s=Object(l.a)(o,2),d=s[0],j=s[1],b=Object(c.useRef)(),u=Object(c.useRef)(),h=e=>Array.from(e.values()).map((e=>e.track)).filter((e=>null!==e));return Object(c.useEffect)((()=>{i(h(e.videoTracks)),j(h(e.audioTracks));return e.on("trackSubscribed",(e=>{"video"===e.kind?i((t=>[...t,e])):"audio"===e.kind&&j((t=>[...t,e]))})),e.on("trackUnsubscribed",(e=>{"video"===e.kind?i((t=>t.filter((t=>t!==e)))):"audio"===e.kind&&j((t=>t.filter((t=>t!==e))))})),()=>{i([]),j([]),e.removeAllListeners()}}),[e]),Object(c.useEffect)((()=>{const e=r[0];if(e)return e.attach(b.current),()=>{e.detach()}}),[r]),Object(c.useEffect)((()=>{const e=d[0];if(e)return e.attach(u.current),()=>{e.detach()}}),[d]),Object(a.jsxs)("div",{className:"participant",children:[Object(a.jsx)("h3",{children:e.identity}),Object(a.jsx)("video",{ref:b,autoPlay:!0}),Object(a.jsx)("audio",{ref:u,autoPlay:!0,muted:!0})]})};var O=({roomName:e,room:t,handleLogout:n})=>{const r=Object(c.useState)([]),i=Object(l.a)(r,2),o=i[0],s=i[1];Object(c.useEffect)((()=>{const e=e=>{s((t=>[...t,e]))},n=e=>{s((t=>t.filter((t=>t!==e))))};return t.on("participantConnected",e),t.on("participantDisconnected",n),t.participants.forEach(e),()=>{t.off("participantConnected",e),t.off("participantDisconnected",n)}}),[t]);const d=o.map((e=>Object(a.jsx)(h,{participant:e},e.sid)));return Object(a.jsxs)("div",{className:"room",children:[Object(a.jsxs)("h2",{children:["Room: ",e]}),Object(a.jsx)("button",{onClick:n,children:"Log out"}),Object(a.jsx)("div",{className:"local-participant",children:t?Object(a.jsx)(h,{participant:t.localParticipant},t.localParticipant.sid):""}),Object(a.jsx)("h3",{children:"Remote Participants"}),Object(a.jsx)("div",{className:"remote-participants",children:d})]})};var m=()=>{const e=Object(c.useState)(""),t=Object(l.a)(e,2),n=t[0],r=t[1],i=Object(c.useState)(""),o=Object(l.a)(i,2),j=o[0],h=o[1],m=Object(c.useState)(null),p=Object(l.a)(m,2),f=p[0],x=p[1],v=Object(c.useState)(!1),k=Object(l.a)(v,2),g=k[0],w=k[1],y=Object(c.useCallback)((e=>{r(e.target.value)}),[]),C=Object(c.useCallback)((e=>{h(e.target.value)}),[]),S=Object(c.useCallback)(function(){var e=Object(d.a)(s.a.mark((function e(t){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),w(!0),e.next=4,fetch("/video/token",{method:"POST",body:JSON.stringify({identity:n,room:j}),headers:{"Content-Type":"application/json"}}).then((e=>e.json()));case 4:a=e.sent,b.a.connect(a.token,{name:j}).then((e=>{w(!1),x(e)})).catch((e=>{console.error(e),w(!1)}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[j,n]),E=Object(c.useCallback)((()=>{x((e=>(e&&(e.localParticipant.tracks.forEach((e=>{e.track.stop()})),e.disconnect()),null)))}),[]);let N;return Object(c.useEffect)((()=>{if(f){const e=e=>{e.persisted||f&&E()};return window.addEventListener("pagehide",e),window.addEventListener("beforeunload",e),()=>{window.removeEventListener("pagehide",e),window.removeEventListener("beforeunload",e)}}}),[f,E]),N=f?Object(a.jsx)(O,{roomName:j,room:f,handleLogout:E}):Object(a.jsx)(u,{username:n,roomName:j,handleUsernameChange:y,handleRoomNameChange:C,handleSubmit:S,connecting:g}),N};var p=()=>Object(a.jsxs)("div",{className:"app",children:[Object(a.jsx)("header",{children:Object(a.jsx)("h1",{children:"StudyBuddies"})}),Object(a.jsx)("main",{children:Object(a.jsx)(m,{})}),Object(a.jsx)("footer",{children:Object(a.jsxs)("p",{children:["Made with"," ",Object(a.jsx)("span",{role:"img","aria-label":"React",children:"\u269b\ufe0f"})," ","by ",Object(a.jsx)("a",{href:"https://twitter.com/philnash",children:"philnash"})]})})]});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(a.jsx)(p,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((e=>{e.unregister()}))},81:function(e,t,n){},82:function(e,t,n){}},[[185,1,2]]]);
//# sourceMappingURL=main.a8a62cfc.chunk.js.map