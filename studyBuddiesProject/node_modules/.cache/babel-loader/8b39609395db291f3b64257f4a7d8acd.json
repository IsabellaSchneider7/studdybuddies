{"ast":null,"code":"import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"C:/Users/Chris/Desktop/hackathon/studdybuddies/studyBuddiesProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Chris/Desktop/hackathon/studdybuddies/studyBuddiesProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Chris/Desktop/hackathon/studdybuddies/studyBuddiesProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useCallback,useEffect}from\"react\";import Video from\"twilio-video\";import Lobby from\"./Lobby\";import Room from\"./Room\";const VideoChat=()=>{const _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUsername=_useState2[1];const _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),roomName=_useState4[0],setRoomName=_useState4[1];const _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),room=_useState6[0],setRoom=_useState6[1];const _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),connecting=_useState8[0],setConnecting=_useState8[1];const handleUsernameChange=useCallback(event=>{setUsername(event.target.value);},[]);const handleRoomNameChange=useCallback(event=>{setRoomName(event.target.value);},[]);const handleSubmit=useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:event.preventDefault();setConnecting(true);_context.next=4;return fetch(\"/video/token\",{method:\"POST\",body:JSON.stringify({identity:username,room:roomName}),headers:{\"Content-Type\":\"application/json\"}}).then(res=>res.json());case 4:data=_context.sent;Video.connect(data.token,{name:roomName}).then(room=>{setConnecting(false);setRoom(room);}).catch(err=>{console.error(err);setConnecting(false);});case 6:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}(),[roomName,username]);const handleLogout=useCallback(()=>{setRoom(prevRoom=>{if(prevRoom){prevRoom.localParticipant.tracks.forEach(trackPub=>{trackPub.track.stop();});prevRoom.disconnect();}return null;});},[]);useEffect(()=>{if(room){const tidyUp=event=>{if(event.persisted){return;}if(room){handleLogout();}};window.addEventListener(\"pagehide\",tidyUp);window.addEventListener(\"beforeunload\",tidyUp);return()=>{window.removeEventListener(\"pagehide\",tidyUp);window.removeEventListener(\"beforeunload\",tidyUp);};}},[room,handleLogout]);let render;if(room){render=/*#__PURE__*/_jsx(Room,{roomName:roomName,room:room,handleLogout:handleLogout});}else{render=/*#__PURE__*/_jsx(Lobby,{username:username,roomName:roomName,handleUsernameChange:handleUsernameChange,handleRoomNameChange:handleRoomNameChange,handleSubmit:handleSubmit,connecting:connecting});}return render;};export default VideoChat;","map":{"version":3,"sources":["C:/Users/Chris/Desktop/hackathon/studdybuddies/studyBuddiesProject/src/VideoChat.js"],"names":["React","useState","useCallback","useEffect","Video","Lobby","Room","VideoChat","username","setUsername","roomName","setRoomName","room","setRoom","connecting","setConnecting","handleUsernameChange","event","target","value","handleRoomNameChange","handleSubmit","preventDefault","fetch","method","body","JSON","stringify","identity","headers","then","res","json","data","connect","token","name","catch","err","console","error","handleLogout","prevRoom","localParticipant","tracks","forEach","trackPub","track","stop","disconnect","tidyUp","persisted","window","addEventListener","removeEventListener","render"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect } from \"react\";\r\nimport Video from \"twilio-video\";\r\nimport Lobby from \"./Lobby\";\r\nimport Room from \"./Room\";\r\n\r\nconst VideoChat = () => {\r\n  const [username, setUsername] = useState(\"\");\r\n  const [roomName, setRoomName] = useState(\"\");\r\n  const [room, setRoom] = useState(null);\r\n  const [connecting, setConnecting] = useState(false);\r\n\r\n  const handleUsernameChange = useCallback((event) => {\r\n    setUsername(event.target.value);\r\n  }, []);\r\n\r\n  const handleRoomNameChange = useCallback((event) => {\r\n    setRoomName(event.target.value);\r\n  }, []);\r\n\r\n  const handleSubmit = useCallback(\r\n    async (event) => {\r\n      event.preventDefault();\r\n      setConnecting(true);\r\n      const data = await fetch(\"/video/token\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify({\r\n          identity: username,\r\n          room: roomName,\r\n        }),\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      }).then((res) => res.json());\r\n      Video.connect(data.token, {\r\n        name: roomName,\r\n      })\r\n        .then((room) => {\r\n          setConnecting(false);\r\n          setRoom(room);\r\n        })\r\n        .catch((err) => {\r\n          console.error(err);\r\n          setConnecting(false);\r\n        });\r\n    },\r\n    [roomName, username]\r\n  );\r\n\r\n  const handleLogout = useCallback(() => {\r\n    setRoom((prevRoom) => {\r\n      if (prevRoom) {\r\n        prevRoom.localParticipant.tracks.forEach((trackPub) => {\r\n          trackPub.track.stop();\r\n        });\r\n        prevRoom.disconnect();\r\n      }\r\n      return null;\r\n    });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (room) {\r\n      const tidyUp = (event) => {\r\n        if (event.persisted) {\r\n          return;\r\n        }\r\n        if (room) {\r\n          handleLogout();\r\n        }\r\n      };\r\n      window.addEventListener(\"pagehide\", tidyUp);\r\n      window.addEventListener(\"beforeunload\", tidyUp);\r\n      return () => {\r\n        window.removeEventListener(\"pagehide\", tidyUp);\r\n        window.removeEventListener(\"beforeunload\", tidyUp);\r\n      };\r\n    }\r\n  }, [room, handleLogout]);\r\n\r\n  let render;\r\n  if (room) {\r\n    render = (\r\n      <Room roomName={roomName} room={room} handleLogout={handleLogout} />\r\n    );\r\n  } else {\r\n    render = (\r\n      <Lobby\r\n        username={username}\r\n        roomName={roomName}\r\n        handleUsernameChange={handleUsernameChange}\r\n        handleRoomNameChange={handleRoomNameChange}\r\n        handleSubmit={handleSubmit}\r\n        connecting={connecting}\r\n      />\r\n    );\r\n  }\r\n  return render;\r\n};\r\n\r\nexport default VideoChat;\r\n"]},"metadata":{},"sourceType":"module"}